<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>placeQue - Smart Placement System | Training & Placement</title>

	<!-- Site favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="vendors/images/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="images/logo23.png">
	<link rel="icon" type="image/png" sizes="16x16" href="vendors/images/favicon-16x16.png">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="vendors/styles/core.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/icon-font.min.css">
	<link rel="stylesheet" type="text/css" href="src/plugins/datatables/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="src/plugins/datatables/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/style.css">
    
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-119386393-1');

	
	$(function () {
			$.get("commonNavigation.html", function (data) {
				$(".navigation").append(data);
			});
		});

	</script>
</head>

<body>

	<div class="navigation"></div>
	<div class="main-container">
		<div class="pd-ltr-20 height-100-p xs-pd-20-10">
			<div class="min-height-200px">
				<div class="page-header">
					<div class="row">
						<div class="col-md-12 col-sm-12">
							<div class="title">
								<h4>Blog</h4>
							</div>
							<nav aria-label="breadcrumb" role="navigation">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="index.html">Home</a></li>
									<li class="breadcrumb-item active" aria-current="page">Blog</li>
								</ol>
							</nav>
						</div>
					</div>
				</div>
				<div class="blog-wrap">
					<div class="container pd-0">
						<div class="row">
							<div class="col-md-12 col-sm-12">
								<div class="blog-list">
									  <ul id="timeline" >
										
										<li>
											
										</li>
											
										
										
										
										
									</ul>
								</div>
								
							</div>
							
						</div>
					</div>
				</div>
			</div>
			<div class="footer-wrap pd-20 mb-20 card-box">
				placeQue - Smart Placement System <a href="https://github.com/dropways" target="_blank">NRSH</a>
			</div>
		</div>
	</div>
	
	
	
	<!-- js -->
	<script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/script.min.js"></script>
	<script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/process.js"></script>
	<script src="vendors/scripts/layout-settings.js"></script>
	<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.responsive.min.js"></script>
	<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
	<!-- buttons for Export datatable -->
	
	<!-- Datatable Setting js -->
	<script src="vendors/scripts/datatable-setting.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase.js"></script>
	<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js"></script>

	<!-- Add Firebase products that you want to use -->
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>
</body>

<script>
	var firebaseConfig = {
		apiKey: "AIzaSyBrjKsOT5YXZSYFVOa3PeBi3997XdKJRbw",
		authDomain: "placeque-47156.firebaseapp.com",
		databaseURL: "https://placeque-47156-default-rtdb.firebaseio.com",
		projectId: "placeque-47156",
		storageBucket: "placeque-47156.appspot.com",
		messagingSenderId: "387944466952",
		appId: "1:387944466952:web:3ec6cfefc5682e3431dfbd",
		measurementId: "G-N7RD97TPP5"
	};
	//initialize firebase
	firebase.initializeApp(firebaseConfig);
	let formMessage = firebase.database().ref('adminTimelineData');
	var sc;
	formMessage.on('value',gotData,errData)

	function gotData(data){
		sc=data.val();
		var keys=Object.keys(sc);
		document.getElementById("timeline").innerHTML=""
		for(var i=keys.length-1;i>=0;i--){
		var k=keys[i]
		Author=sc[k].author
		postedtime=sc[k].timeOfPost
		authordept=sc[k].authorDept
		timelineimage=sc[k].timelineUrl
		timelinetext=sc[k].timelineText
		let uids = window.localStorage.getItem("userId")
		let ad = JSON.parse(window.localStorage.getItem("adminData"))
		document.getElementById("timeline").innerHTML+= 
		`	<li> 
			<div class="col-lg-12 col-md-12 col-sm-12">
				<div class="blog-img">
					<img src=`+timelineimage+` alt=""  style="width:100%;height:70%;object-fit:cover">
				</div>
			</div>
			<div class="col-lg-12 col-md-12 col-sm-12">
				<div class="blog-caption">
					<span class="date text-black-50"><span style="font-weight:700">Posted by - `+Author+`,</span> on - `+postedtime+`,`+authordept+`</span>
			        <div class="blog-by">
						<p>`+timelinetext+`</p>
															
					</div>
				</div>
			</div>
			
      		<div class="d-flex flex-column comment-section">
				<div id="commentSection`+k+`" style="max-height:200px;overflow-y:scroll">
					
					
				</div>
					
				<div class="bg-light p-2">
					<div class="d-flex flex-row align-items-start"><img class="rounded-circle" src="`+window.localStorage.getItem("image")+`" width="40"><input type="text" id="cmtmsg`+k+`" class="form-control ml-1  shadow-none textarea" style="height: 5em;"></div>
					<div class="mt-2 text-right"><button class="btn btn-primary btn-sm shadow-none"  onclick=sendComment("`+k+`","`+uids+`") type="button">Post comment</button></div>
				</div>
			</div>
			
			</li>`
			if(sc[k].comments){
				let name= "anonymous"
				let image = "https://upload.wikimedia.org/wikipedia/commons/7/70/User_icon_BLACK-01.png";
				let std=JSON.parse(window.localStorage.getItem("studentDatabase"))
				document.getElementById("commentSection"+k).innerHTML =""
				for(let j=0;j<sc[k].comments.length;j++){
					// alert(sc[k].comments[j].user)
					
					
					if(sc[k].comments[j].type =="admin"){
						image =ad[sc[k].comments[j].user].photoUrl
						names=ad[sc[k].comments[j].user].name
					}else{
						names =std[sc[k].comments[j].user].Name
						if(std[sc[k].comments[j].user].photoUrl){
							image = std[sc[k].comments[j].user].photoUrl
						}else{
							image = "https://upload.wikimedia.org/wikipedia/commons/7/70/User_icon_BLACK-01.png";
						}
					}
					
				document.getElementById("commentSection"+k).innerHTML +=
				`
				<div class="bg-white p-2" >
						<div class="d-flex flex-row user-info"><img class="rounded-circle" src="`+image+`" style="width:50px;height:50px;object-fit:cover">
							<div class="d-flex flex-column justify-content-start ml-2"><span class="d-block font-weight-bold name">`+ names+`</span><span class="date text-black-50">`+sc[k].comments[j].time+`</span></div>
						</div>
						<div class="mt-2">
							<p class="comment-text">`+sc[k].comments[j].Message+`</p>
						</div>
				</div>
				` 
			}
		}
			
		}

	}

	
	function errData(){
		console.log("as")
	}
	

	function sendComment(postid,userid){
	
		let message = document.getElementById("cmtmsg"+postid).value
		var arr2 = []
		
	
		let refData2= firebase.database().ref('adminTimelineData').child(postid)
		console.log(arr2)
		 refData2.on('value', (snapshot) => {
			data = snapshot.val();
			console.log(data)
			if(data.comments){

				for(let i =0 ;i<data.comments.length;i++){
				
					arr2.push(data.comments[i])
					console.log(arr2)
				}
				
			}
		})
	
		
		if(message!=""){
			arr2.push(
			{
				"Message": message,
				"type":"admin",
				"user" : userid,
				"time" : new Date().toString()

			}
			)
			console.log("0000000000")
			console.log(arr2)
			data2={
				comments :arr2
			}
			console.log(data2)
			console.log(postid)
			setTimeout(function(){
				firebase.database().ref('adminTimelineData').child(postid).update(data2)
			},1000)
		

		}
}
</script>

</html>