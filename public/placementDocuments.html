<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>placeQue - Smart Placement System | Training & Placement</title>

	<!-- Site favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="vendors/images/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="images/logo23.png">
	<link rel="icon" type="image/png" sizes="16x16" href="vendors/images/favicon-16x16.png">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<!-- CSS -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="vendors/styles/core.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/icon-font.min.css">
	<link rel="stylesheet" type="text/css" href="src/plugins/dropzone/src/dropzone.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/style.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-119386393-1');
		$(function () {                                                                                                                                                                                                                                                                                                      
			$.get("commonNavigation.html", function (data) {
				$("#navigation").append(data);
			});
		});

	</script>
</head>
<body>
	<div id="navigation"></div>
	<div class="main-container">
		<div class="pd-ltr-20 xs-pd-20-10">
			<div class="min-height-200px">
				<div class="page-header">
					<div class="row">
						<div class="col-md-6 col-sm-12">
							<div class="title">
								<h4>Upload Study Materials</h4>
							</div>
							<nav aria-label="breadcrumb" role="navigation">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="index.html">Home</a></li>
									<li class="breadcrumb-item active" aria-current="page">placementDocuments</li>
								</ol>
							</nav>
						</div>
				
					</div>
				</div>

				<div class="pd-20 card-box mb-30">
					<div class="clearfix mb-20">
						<div class="pull-left">
							<h4 class="text-blue h4">Upload PDF(ONLY) File Here</h4>
						</div>
					</div>
					<form class="dropzoe" action="/file-upload" id="my-awesome-dropzone">
						<div class="fallback">
							<input type="file" onchange="readURL(this)" name="file" />
						</div>
					</form>
				</div>
                <div class="html-editor pd-20 card-box mb-30">
					<h4 class="h4 text-blue">Material Title</h4>
					<!-- <p>Simple, beautiful wysiwyg editors</p> -->
					<input type="text" class=" form-control border-radius-0" id="documentTitle" placeholder="Enter title">
				</div>
				<div class="html-editor pd-20 card-box mb-30">
					<h4 class="h4 text-blue">Enter something about pdf</h4>
					<!-- <p>Simple, beautiful wysiwyg editors</p> -->
					<textarea class="textarea_editor form-control border-radius-0" id="documentText" placeholder="Start Typing here..."></textarea>
				</div>
				<div class="btn-list">
					<button type="button" class="btn btn-success btn-lg btn-block" id="uploadNow" onclick="uploadFile()">Post Document</button>
		
				</div>

			</div>
			<div class="footer-wrap pd-20 mb-20 card-box">
				placeQue - Smart Placement System <a href="https://github.com/dropways" target="_blank">NRSH</a>
			</div>
		</div>
	</div>
	<!-- js -->
	<!-- <script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/script.min.js"></script>
	<script src="vendors/scripts/process.js"></script> -->
	<script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/layout-settings.js"></script>
	<script src="src/plugins/dropzone/src/dropzone.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase.js"></script>
    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js"></script>
    
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>

<script>
	let index2=0
// 	let interval2= setInterval(function(){
// 	index2++;
// 	if(index2==1){
// 		clearInterval(interval2)
// 	}
	var firebaseConfig = {
		apiKey: "AIzaSyBrjKsOT5YXZSYFVOa3PeBi3997XdKJRbw",
		authDomain: "placeque-47156.firebaseapp.com",
		databaseURL: "https://placeque-47156-default-rtdb.firebaseio.com",
		projectId: "placeque-47156",
		storageBucket: "placeque-47156.appspot.com",
		messagingSenderId: "387944466952",
		appId: "1:387944466952:web:3ec6cfefc5682e3431dfbd",
		measurementId: "G-N7RD97TPP5"
	};
	// Initialize Firebase
	firebase.initializeApp(firebaseConfig);
// 	firebase.analytics();
	var user1;
	var  storageService = firebase.storage();
	var refer= firebase.database();
	firebase.auth().onAuthStateChanged(function(user) {
		if(user){
			console.log(user)
			user1=user
		    
		}else{
            window.location="login.html"
        }

	})

		Dropzone.autoDiscover = false;
		$(".dropzone").dropzone({
			addRemoveLinks: true,
			removedfile: function(file) {
				var name = file.name;
				var _ref;
				return (_ref = file.previewElement) != null ? _ref.parentNode.removeChild(file.previewElement) : void 0;
			}
		});
		var selectedFile;

		function readURL(input) {
			
			if (input.files && input.files[0]) {
			
			// var reader = new FileReader();
			// reader.onload = function (e) {
			// 	$('#blah')
			// 	.attr('src', e.target.result);
			// };
			// console.log(user)
			selectedFile=input.files[0];
			// reader.readAsDataURL(input.files[0]);
			// document.getElementById("selectPic").style.display="none"
			// document.getElementById("uploadNow").style.display="block"
			// document.getElementById("clear").style.display="block"


			}
		}
		function uploadFile(){
			
			let uploadText = document.querySelector("#documentText").value
			let docTitle = document.querySelector("#documentTitle").value
			var uploadTask=storageService.ref(`/DocumentPDFS/${selectedFile.name}`).put(selectedFile);
			uploadTask.on('state_changed', function(snapshot){
				var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
				progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;

				document.getElementById("uploadNow").innerHTML = progress;
					switch (snapshot.state) {
					case firebase.storage.TaskState.PAUSED: // or 'paused'
					document.getElementById("uploadNow").innerHTML = "Upload Paused";
					console.log('Upload is paused');
					break;
					case firebase.storage.TaskState.RUNNING: // or 'running'
					document.getElementById("uploadNow").innerHTML = progress+"%";

					break;
					}
					},function(error){
						console.log(error);
							// Handle unsuccessful uploads
						}, function() {
					document.getElementById("uploadNow").innerHTML = "Uploaded"+ " "+progress+"%";

					uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
					
              
            
					urls2 = downloadURL;
					console.log(urls2)
					let formMessage = refer.ref("DocumentData")
					
					let user= window.localStorage.getItem("user")
					var newDate = new Date().toString();

				
					let newFormMessage=formMessage.push()
					newFormMessage.set({
						author : window.localStorage.getItem("username"),
						authorImage :window.localStorage.getItem("image"),
						authorEmail :window.localStorage.getItem("email"),
						authorDept : window.localStorage.getItem("dept"),
						timeOfPost :newDate,
						documentUrl: urls2,
						documentText : uploadText,
						documentTitle :docTitle
					})
					});
				})
    	}
	</script>
</body>
</html>