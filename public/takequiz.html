<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
	<title>placeQue | HOME </title>
    <link rel="icon" href="images/logo23.png" type="image/png" sizes="16x16"> 
    
    <link rel="stylesheet" href="css/main.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/color.css">
    <link rel="stylesheet" href="css/responsive.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/placeholder-loading/dist/css/placeholder-loading.min.css">
</head>
<style>
	.modal-dialog-full-width {
        width: 100% !important;
        height: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        max-width:none !important;

    }
	body {
    background-color: #a04c65
}

    .modal-content-full-width  {
        height: auto !important;
        min-height: 100% !important;
        border-radius: 0 !important;
        background-color: #ececec !important 
    }

    .modal-header-full-width  {
        border-bottom: 1px solid #9ea2a2 !important;
    }

    .modal-footer-full-width  {
        border-top: 1px solid #9ea2a2 !important;
    }
	
</style>
<script>
		
		$(document).ready(function(){
		
		$('#navigation').load("commonNavigation.html");
        $('#footerCommon').load("footerCommon.html");

 });
</script>
<body >
<!--<div class="se-pre-con"></div>-->
<div class="theme-layout">
	<div id="navigation"></div>


	<section>
			<br>
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<div class="row" id="page-contents">
							
					 
								<div class="col-md-12 col-lg-12">
									
									<div class="border">
										<div class="question bg-white p-3 border-bottom" style="">
											<div class="d-flex flex-row justify-content-between align-items-center mcq">
												<h4>MCQ Quiz</h4><span id="totQues"></span> <span id ="timeLeft" style="color: green;font-weight: 700;font-size: 24px;">12</span>
											</div>
										</div>
										<div class="question bg-white p-3 border-bottom" id="questions" style="height: 600px;overflow: scroll;">

										</div>
										<div class="d-flex flex-row justify-content-between align-items-center p-3 bg-white"><button class="btn btn-primary border-success align-items-center btn-success" type="button" style="margin-left:auto; margin-right: auto;display: block;" onclick="submitQuiz()">Submit</button></div>
									</div>
								</div>
						</div>	
					</div>
				</div>
			</div>
		</div>	
		</section>
	
	<div id="footerCommon"></div><!-- footer -->
	<div class="bottombar">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<span class="copyright"><a target="_blank" href="https://www.templateshub.net">placeQue @2021</a></span>
					
				</div>
			</div>
		</div>
	</div>
</div>
	<div class="side-panel">
			<h4 class="panel-title">General Setting</h4>
			<form method="post">
				<div class="setting-row">
					<span>use night mode</span>
					<input type="checkbox" id="nightmode1"/> 
					<label for="nightmode1" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Notifications</span>
					<input type="checkbox" id="switch22" /> 
					<label for="switch22" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Notification sound</span>
					<input type="checkbox" id="switch33" /> 
					<label for="switch33" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>My profile</span>
					<input type="checkbox" id="switch44" /> 
					<label for="switch44" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Show profile</span>
					<input type="checkbox" id="switch55" /> 
					<label for="switch55" data-on-label="ON" data-off-label="OFF"></label>
				</div>
			</form>
			<h4 class="panel-title">Account Setting</h4>
			<form method="post">
				<div class="setting-row">
					<span>Sub users</span>
					<input type="checkbox" id="switch66" /> 
					<label for="switch66" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>personal account</span>
					<input type="checkbox" id="switch77" /> 
					<label for="switch77" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Business account</span>
					<input type="checkbox" id="switch88" /> 
					<label for="switch88" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Show me online</span>
					<input type="checkbox" id="switch99" /> 
					<label for="switch99" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Delete history</span>
					<input type="checkbox" id="switch101" /> 
					<label for="switch101" data-on-label="ON" data-off-label="OFF"></label>
				</div>
				<div class="setting-row">
					<span>Expose author name</span>
					<input type="checkbox" id="switch111" /> 
					<label for="switch111" data-on-label="ON" data-off-label="OFF"></label>
				</div>
			</form>
		</div><!-- side panel -->		
		<div class="modal fade" id="quizCompleted" tabindex="-1" role="dialog" aria-labelledby="quizCompletedTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
			  <div class="modal-content">
				<div class="modal-header">
				  <h5 class="modal-title" id="exampleModalLongTitle">Quiz Submitted</h5>
				  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				  </button>
				</div>
				<div class="modal-body">
				  Your quiz is submitted successfully . 
				  The results can be viewed under quiz result section. 

					<br>
					Thankyou for taking up the test.
				</div>
				<div class="modal-footer">
					<p> Please wait redirecting .......</p>
				</div>
			  </div>
			</div>
		  </div>
	<!-- <script src="js/main.min.js"></script>
	<script src="js/script.js"></script> -->
	


</body>	
<!-- <script src="js/main.min.js"></script>
<script src="js/script.js"></script> -->

<script>
	
	var sc =JSON.parse(window.localStorage.getItem("quizDetails"))
	if(!sc){
		window.location= "verifyQuiz.html"
	}
	var key =window.localStorage.getItem("user")
	
	let ques = sc[window.localStorage.getItem("quizKey")].question

	let endTime =sc[window.localStorage.getItem("quizKey")].info.date + " "+(sc[window.localStorage.getItem("quizKey")].info.endTime).substring(0,5)
	
	document.getElementById("totQues").innerHTML = "Total Questions :"+ ques.length
	var countDownDate = new Date(endTime).getTime();
	var myfunc = setInterval(function() {
	// code goes here
	var now = new Date().getTime();
	var timeleft = countDownDate - now;
		
	var days = Math.floor(timeleft / (1000 * 60 * 60 * 24));
	var hours = Math.floor((timeleft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
	var minutes = Math.floor((timeleft % (1000 * 60 * 60)) / (1000 * 60));
	var seconds = Math.floor((timeleft % (1000 * 60)) / 1000);
	var totTime = hours + ":" +minutes + ":"+seconds  
	document.getElementById("timeLeft").innerHTML = totTime
	// document.getElementById("mins").innerHTML = minutes + "m " 
	// document.getElementById("secs").innerHTML = seconds + "s"

	if (timeleft < 0) {
		clearInterval(myfunc);
	
		document.getElementById("timeLeft").innerHTML = " "
		window.localStorage.clear("quizInstruction")
		window.localStorage.clear("quizKey")
		window.localStorage.clear("quizDetails")
		
		submitQuiz()
	}

	if (timeleft < 500000) {
		
	
		document.getElementById("timeLeft").style.color="red"

	}
	}, 1000)

	for(let i = 0;i<ques.length;i++){
		document.getElementById("questions").innerHTML +=
		`
		<div class="d-flex flex-row align-items-center question-title">
			<div style="display:flex">
			<h6 class="text-danger">Q. `+(i+1)+`</h6>
			<h5 class="mt-1 ml-2">`+ques[i].question+`</h5>
			
			</div>
			
		</div>
		<div id="opt`+i+`"></div>
		

		`
		
		if(ques[i].op1){
			document.getElementById("opt"+i).innerHTML += `<div class="ans ml-2">
				<label class="radio"><input class="`+ques[i].quesId+`" type="`+ques[i].type+`" id="`+ques[i].op1+i+`" name="`+ques[i].question+`" value="`+ques[i].op1+`" point="`+ques[i].point+`"> <span>`+ques[i].op1+`</span>
				</label>
			</div>`
		}

		if(ques[i].op2){
			document.getElementById("opt"+i).innerHTML += `<div class="ans ml-2">
				<label class="radio"><input class="`+ques[i].quesId+`" type="`+ques[i].type+`" id="`+ques[i].op2+i+`" name="`+ques[i].question+`" value="`+ques[i].op2+`" point="`+ques[i].point+`"> <span>`+ques[i].op2+`</span>
				</label>
			</div>`
		}
		if(ques[i].op3){
			document.getElementById("opt"+i).innerHTML += `<div class="ans ml-2">
				<label class="radio"><input class="`+ques[i].quesId+`" type="`+ques[i].type+`" id="`+ques[i].op3+i+`" name="`+ques[i].question+`" value="`+ques[i].op3+`" point="`+ques[i].point+`"> <span>`+ques[i].op3+`</span>
				</label>
			</div>`
		}
		if(ques[i].op4){
			document.getElementById("opt"+i).innerHTML += `<div class="ans ml-2">
				<label class="radio"><input class="`+ques[i].quesId+`" type="`+ques[i].type+`" id="`+ques[i].op4+i+`" name="`+ques[i].question+`" value="`+ques[i].op4+`" point="`+ques[i].point+`"> <span>`+ques[i].op4+`</span>
				</label>
			</div>`
		}
		if(ques[i].op5){
			document.getElementById("opt"+i).innerHTML += `<div class="ans ml-2">
				<label class="radio1"><input class="`+ques[i].type+`" type="`+ques[i].type+`" id="`+ques[i].op5+i+`" name="`+ques[i].question+`" value="`+ques[i].op5+`" point="`+ques[i].point+`"> <span>`+ques[i].op5+`</span>
				</label>
			</div>`
		}
			
	}



	function submitQuiz(){
		var total = 0
		var tempObj = {}

		for(let i = 0;i<ques.length;i++){ 
			tempObj[ques[i].quesId] = []
			
			$("."+ques[i].quesId).each(function() {
				if ($(this).is(':checked') == true) {
					tempObj[ques[i].quesId].push($(this).val())
				}
			});
			
			if(tempObj[ques[i].quesId].join(',') === ques[i].answer ) {
				total = total + parseInt(ques[i].point)
			}
		}
		console.log(total)
		var arr = []
		
		let refData2= firebase.database().ref('studentData').child(key)
	
		refData2.on('value', (snapshot) => {
			data = snapshot.val();
			if(data.quizScores){
				for(let i =0 ;i<data.quizScores.length;i++){
					arr.push(data.quizScores[i])
				}
			}

	
		})
		
			let quizMarks ={
				"code":sc[window.localStorage.getItem("quizKey")].info.id,
				"id" : window.localStorage.getItem("quizKey"),
				"score" :total	
			}
			arr.push(quizMarks)
			
			let quizData ={
				quizScores :arr
			}
	
		firebase.database().ref("studentData").child(key).update(quizData).then(function(){
			$('#quizCompleted').modal('show');
			setTimeout(function(){
				window.localStorage.clear("quizInstruction")
				window.localStorage.clear("quizKey")
				window.localStorage.clear("quizDetails")
				window.location= "verifyQuiz.html"
			},6000)
		})
		

	}










	function verifyCode(){
		let code=document.getElementById("code").value
		let quizData = firebase.database().ref('quizData')
       	quizData.on('value',gotData,errData)


        function gotData(data){
			let year= "0"
            let sc= data.val()
			let flag=undefined
			let keys=Object.keys(sc)
			for(let i =0;i<keys.length;i++){
				let key = keys[i]
				console.log(sc[key].info.id)
				if(code == sc[key].info.id){
					flag  = key
					break;
				}
			}
			if(window.localStorage.getItem("sem")==1 || window.localStorage.getItem("sem")==2){
				year="1"
			}else if (window.localStorage.getItem("sem")==3 || window.localStorage.getItem("sem")==4){
				year="2"
			}else if(window.localStorage.getItem("sem")==5 || window.localStorage.getItem("sem")==6){
				year="3"
			}else{
				year="4"
			}
			if(flag){
				console.log(sc[flag].info.selectedYear)
				if((sc[flag].info.selectedBranches).includes(window.localStorage.getItem("branch")) && (sc[flag].info.selectedYear).includes(year) ){
					window.localStorage.setItem("quizKey",flag)
					window.localStorage.setItem("quizInstruction",sc[flag].instruction)
					window.localStorage.setItem("quizDetails",JSON.stringify(sc))
					window.location="instructionquiz.html"
				}else{
					document.getElementById("verify").style.backgroundColor="red"

					document.getElementById("verify").innerHTML="Invalid Code"
					setTimeout(function(){
						document.getElementById("verify").style.backgroundColor="#4DB7FE"

						document.getElementById("verify").innerHTML="Verify"
					},3000)
				}
			}else{
				document.getElementById("verify").style.backgroundColor="red"

					document.getElementById("verify").innerHTML="Invalid Code"
					setTimeout(function(){
						document.getElementById("verify").style.backgroundColor="#4DB7FE"

						document.getElementById("verify").innerHTML="Verify"
					},3000)
			}
			
			

        }
		function errData(){

		}



	}
</script>
</html>