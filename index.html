<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
	<title>placeQue Social Network Toolkit</title>
    <link rel="icon" href="images/logo23.png" type="image/png" sizes="16x16"> 
    
    <link rel="stylesheet" href="css/main.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/color.css">
    <link rel="stylesheet" href="css/responsive.css">

</head>
<body>
<!--<div class="se-pre-con"></div>-->
<div id="overlay"></div>
<div id="loader" style="z-index: 9999999;top:100%">
    <div id="box"></div>
    <div id="hill"></div>
</div>
<div class="theme-layout">
	<div class="container-fluid pdng0">
		<div class="row merged">
		
			<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
				
				<div class="login-reg-bg">
					<div class="log-reg-area sign" id="log">
						<div class="friend-l">
							<img src="images/logo23.png" style="margin-left: auto;margin-right: auto;width: 130px;; display: block;" alt="">
						</div>
						<h2 class="log-title">Login</h2>
						
						<form method="post">
							<div class="form-group">	
							  <input type="text"  id="user_email" required="required"/>
							  <label class="control-label" for="input">Email</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
							  <input type="password" id="user_password" required="required"/>
							  <label class="control-label" for="input" >Password</label><i class="mtrl-select"></i>
							</div>
							<p id="errorText" style="color: red;"></p>
							<a href="#" title="" onclick="forgetCode()" class="forgot-pwd">Forgot Password?</a>
							<div class="submit-btns">
								<button class="mtr-btn signin" type="button" onclick="login()" id="loginBtn"><span>Login</span></button>
								<button class="mtr-btn signup" type="button" onclick="showRegister()"><span>Register</span></button>
							</div>

						</form>
					</div>
					<div class="log-reg-area reg" id="reg">
						<div class="friend-l">
							<img src="images/logo23.png" style="margin-left: auto;margin-right: auto;width: 130px;; display: block;" alt="">
						</div>
						<h2 class="log-title">Register</h2>
						
						<form method="post">
							<div class="form-group">	
							  <input type="text"  id="name" required="required"/>
							  <label class="control-label" for="input">Name</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
							  <input type="text"  id="email" required="required"/>
							  <label class="control-label" for="input">Email</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
							  <input type="password" id="pass" required="required"/>
							  <label class="control-label" for="input" >Password</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
								<input type="password" id="cpass" required="required"/>
								<label class="control-label" for="input" >Confirm Password</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
								<select class="form-select form-select-sm" aria-label=".form-select-sm example" id="branch">
									<option selected>Select Branch</option>
									<option value="ISE">ISE</option>
									<option value="CSE">CSE</option>
									<option value="EEE">EEE</option>
									<option value="MECH">MECH</option>
									<option value="CIVIL">CIVIL</option>
									<option value="ECE">ECE</option>
								  </select>
								<label class="control-label" for="input" >Branch</label><i class="mtrl-select"></i>
							</div>
							<div class="form-group">	
								<select class="form-select form-select-sm" aria-label=".form-select-sm example" id="semester">
									<option selected>Select Semester</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8">8</option>
								  </select>
								<label class="control-label" for="input" >Semester</label><i class="mtrl-select"></i>
							</div>
							<!-- <div class="checkbox">
							  <label>
								<input type="checkbox" checked="checked"/><i class="check-box"></i>Accept Terms & Conditions ?
							  </label>
							</div> -->
							<a href="#" title="" onclick="showLogin()" class="already-have">Already have an account</a>
							<div class="submit-btns">
								<button class="mtr-btn signup" onclick="submitForm()" type="button"><span>Register</span></button>
							</div>
						</form>
					</div>
					<div class="log-reg-area forgot" id="forgotPass" style="display: none;">
						<div class="friend-l">
							<img src="images/logo23.png" style="margin-left: auto;margin-right: auto;width: 130px;; display: block;" alt="">
						</div>
						<br>
						<h2 class="log-title">Forgot Password</h2>
						
						<form method="post">
							<div class="form-group">	
							  <input type="text"  id="reset_email" required="required"/>
							  <label class="control-label" for="input">Registered Email</label><i class="mtrl-select"></i>
							</div>
							<p id="errorText2" style="color: red;"></p>
							<p id="successText2" style="color: green;"></p>
							<div class="submit-btns">
								<button class="mtr-btn signin" type="button" onclick="resetPassword()"><span>Send Code</span></button>
								<button class="mtr-btn signin" type="button"  onclick="backLogin()""><span>Back to login</span></button>
							</div>
							
						</form>
					</div>
				</div>
			</div>
			<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 hide-small" >
				<div class="land-featurearea">
					<div class="land-meta">
						<h1></h1>
						<p>
						
						</p>
						<div class="friend-l">
							<span><img src="images/login.png" alt=""></span>
						</div>
						<a href="#" title="" class="folow-me"></a>
					</div>	
				</div>
			</div>
		</div>
	</div>
</div>
	
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="js/main.min.js"></script>
<script src="js/script.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase.js"></script>
<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>

</body>	

<script>
	var firebaseConfig = {
	apiKey: "AIzaSyBrjKsOT5YXZSYFVOa3PeBi3997XdKJRbw",
	authDomain: "placeque-47156.firebaseapp.com",
	databaseURL: "https://placeque-47156-default-rtdb.firebaseio.com",
	projectId: "placeque-47156",
	storageBucket: "placeque-47156.appspot.com",
	messagingSenderId: "387944466952",
	appId: "1:387944466952:web:3ec6cfefc5682e3431dfbd",
	measurementId: "G-N7RD97TPP5"
};
	// Initialize Firebase
	setTimeout(function(){
    document.getElementById("overlay").style.display="none"
    document.getElementById("loader").style.display="none"
},800)
	firebase.initializeApp(firebaseConfig);
	firebase.analytics();
	var formStudent= firebase.database().ref('studentData')
	var refData;
	firebase.auth().onAuthStateChanged(function(user) {
		if(user){
			console.log(user.uid)
			refData= firebase.database().ref('studentData').child(user.uid)
			refData.on('value', (snapshot) => {
				const data = snapshot.val();
				console.log(data)

				if(data.studentVerified){
				
					window.location="home.html"
				}else{
					if(user.emailVerified){
						window.location="edit-profile-basic.html"
					}else{
						
						//Email not verified let him login
					}
					
				}
			});
		}else{
			
        }

	})
	function login(){
		let email = document.querySelector("#user_email").value
		let password = document.querySelector("#user_password").value
		firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
			document.getElementById("loginBtn").style.backgroundColor="green"
			document.getElementById("loginBtn").innerHTML="Verified ✔"
			
			// alert("Success")
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					var user = firebase.auth().currentUser;
					refData.on('value', (snapshot) => {
						const data = snapshot.val();
						console.log(data)
						if(data.studentVerified){
							window.location="home.html"
						}else{
						
							if(user.emailVerified == false  || user.emailVerified == "false"){
								user.sendEmailVerification().then(function() {
							
								})
								window.location="edit-profile-basic.html"
						
							}else{
								//Email not verified let him login
								
							}
							
						}
					});
					// user.sendEmailVerification().then(function() {
					// // Email sent.
					// console.log("emailsent")
					// }).catch(function(error) {
					// // An error happened.
					// });
					// User is signed in.
					
					var displayName = user.displayName;
					var email = user.email;

					var emailVerified = user.emailVerified;
					var photoURL = user.photoURL;
					var isAnonymous = user.isAnonymous;
					var uid = user.uid;
					var providerData = user.providerData;

					//console.log(email + "" +providerData)
					
					// ...
				}else {
					document.getElementById("user_email").style.borderColor="red"
					document.getElementById("user_password").style.borderColor="red"

					// User is signed out.
					// ...
				}
			});
		}).catch(function(error) {
		// Handle Errors here.
			var errorCode = error.code;
			var errorMessage = error.message;
			console.log(errorCode);
			if(errorCode.includes("auth/network-request-failed")){
				document.getElementById("errorText").innerHTML="Check your internet connectivtiy & try again. "
			}else{
				document.getElementById("loginBtn").style.backgroundColor="red"
				document.getElementById("loginBtn").innerHTML="Sign In"
				document.getElementById("user_email").style.borderColor="red"
				document.getElementById("user_password").style.borderColor="red"
				document.getElementById("errorText").innerHTML="Invalid Username or password"
				setTimeout(function(){
					document.getElementById("loginBtn").style.backgroundColor="blue"
					document.getElementById("user_email").style.borderColor="gray"
					document.getElementById("user_password").style.borderColor="gray"
					document.getElementById("errorText").innerHTML=""
				},3000)
			}
			console.log(errorMessage);
		});
	}
	function submitForm(){
		let name = document.querySelector("#name").value
		let email = document.querySelector("#email").value
		let password = document.querySelector("#pass").value
		let cpass = document.querySelector("#cpass").value
		let sem = document.querySelector("#semester").value
		let branch = document.querySelector("#branch").value
	
		if(cpass == password){
			firebase.auth().createUserWithEmailAndPassword(email, password).then(function(){
		
				firebase.auth().signInWithEmailAndPassword(email, password).then(function(){
			
				firebase.auth().onAuthStateChanged(function(user) {
					if (user) {
						var user = firebase.auth().currentUser;
						user.sendEmailVerification().then(function() {
						// Email sent.
							var displayName = user.displayName;
							var email = user.email;
							var emailVerified = user.emailVerified;
							var photoURL = user.photoURL;
							var isAnonymous = user.isAnonymous;
							var uid = user.uid;
							var providerData = user.providerData;
						
							console.log("emailsent")

							let newform=formStudent.child(uid)
							console.log("SDS")
								newform.set({
									
									Name : name, 
									EmailName : user.displayName,
									emailVerified : user.emailVerified,
									photoUrl :user.photoURL,
									isAnonymous: user.isAnonymous,
									uid : user.uid,
									password:password,
									email:email,
									studentVerified : false,
									detailsFilled :false,
									sem : sem,
									branch : branch,
									providerData : user.providerData

								}).then(function(){
									window.location="edit-profile-basic.html"
								}).catch(function(error){
									alert(error)
								});
						}).catch(function(error) {
						// An error happened.
						});
					}else {
						// User is signed out.
						// ...
					}
					});
				}).catch(function(error) {
				// Handle Errors here.
					var errorCode = error.code;
					var errorMessage = error.message;
				});
			}).catch(function(error) {
				// Handle Errors here.
				var errorCode = error.code;
				var errorMessage = error.message;
				console.log(errorCode);
				console.log(errorMessage);
			});
			

		}else{
			alert("invalid password")
		}
	}

	function forgetCode(){
	
		document.getElementById("log").style.display="none"
		document.getElementById("reg").style.display="none"
		document.getElementById("forgotPass").style.display="block"
	}	
	function backLogin(){
	
		document.getElementById("log").style.display="block"
		document.getElementById("reg").style.display="none"
		document.getElementById("forgotPass").style.display="none"
	}
	function showRegister(){
	
		document.getElementById("log").style.display="none"
		document.getElementById("reg").style.display="block"
		document.getElementById("forgotPass").style.display="none"
	}
	function showLogin(){
	
	document.getElementById("log").style.display="block"
	document.getElementById("reg").style.display="none"
	document.getElementById("forgotPass").style.display="none"
	}

	function resetPassword(){
		var auth = firebase.auth();
		var emailAddress = document.querySelector("#reset_email").value;
		auth.sendPasswordResetEmail(emailAddress).then(function() {
		// Email sent.
		document.getElementById("successText2").innerHTML="Code Sent Successfully ✔"
		setTimeout(function(){
			document.getElementById("successText2").innerHTML=""
		},3000)
		console.log('Email Sent');
		}).catch(function(error) {
			document.getElementById("errorText2").innerHTML="Email id is not registered ❌"
			setTimeout(function(){
				document.getElementById("errorText2").innerHTML=""
			},3000)
		});
	}
</script>
</html>